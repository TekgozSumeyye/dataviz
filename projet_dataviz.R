#Chemin des bases de donnees
path <- file.path("C:", "Users", "tekgo", "Documents", "GitHub", "dataviz", fsep="\\")
setwd(path)
#R version 4.1.3 (2022-03-10)

#TELECHARGEMENT DES LIBRAIRIES
library(readr)
library(coefplot)
library(ggplot2)
library(labelled)
library(dplyr)
install.packages("RColorBrewer")
library(RColorBrewer)

#IMPORTATION DES BASES DE DONNEES
maths <- read_csv("Maths.csv")
Portuguese <- read_csv("Portuguese.csv")

####I. Introduction####

#Ces donnÃƒÆ’Ã‚Â©es portent sur les rÃƒÆ’Ã‚Â©sultats des ÃƒÆ’Ã‚Â©lÃƒÆ’Ã‚Â¨ves dans l'enseignement 
#secondaire de deux ÃƒÆ’Ã‚Â©coles portugaises. Les attributs des donnÃƒÆ’Ã‚Â©es 
#comprennent les notes des ÃƒÆ’Ã‚Â©lÃƒÆ’Ã‚Â¨ves, les caractÃƒÆ’Ã‚Â©ristiques dÃƒÆ’Ã‚Â©mographiques, 
#sociales et scolaires, et ont ÃƒÆ’Ã‚Â©tÃƒÆ’Ã‚Â© collectÃƒÆ’Ã‚Â©s ÃƒÆ’Ã‚Â  l'aide de rapports et de 
#questionnaires scolaires. Deux ensembles de donnÃƒÆ’Ã‚Â©es sont fournis concernant
#les performances dans deux matiÃƒÆ’Ã‚Â¨res distinctes : Les mathÃƒÆ’Ã‚Â©matiques (mat) et
#la langue portugaise (por). 

#A partir de l'analyse du lien qui pourrait exister entre la consommation d'alcool et les rÃƒÂ©sultats
#scolaires, l'idÃƒÂ©e est de dÃƒÂ©terminer plus gÃƒÂ©nÃƒÂ©ralement quels pourraient ÃƒÂªtre les facteurs affectant la
#rÃƒÂ©ussite scolaire dans le contexte des jeux de donnÃƒÂ©es dont nous disposons.

N1 <- nrow(maths)
N2 <- nrow(Portuguese)
#Pour la base de donnee maths, il y a 395 observations et 33 variables.
#Pour la base de donnee portuguese, il y a 649 observations et 33 variables identiques avec la 1ere bdd. 

fulldt<-bind_rows(maths, Portuguese)
nrow(fulldt)
str(fulldt)
#Avec str, on visualise les premieres donnees des variables, et on regarde si ce sont des variables qualitative ou quantitatives


#### II. Visualisation des donnees####

# a) Ecole
ggplot(as.data.frame(table(fulldt$school))) +
     geom_bar(aes(x = Var1, y = Freq, fill = Var1), 
                           stat = 'identity') +
     scale_fill_manual(values=palette) +
     ggtitle("RÃƒÂ©partition de l'ÃƒÂ©cole") +
     xlab("Ecole") +
     ylab("Effectifs") +
     theme_bw() +
     theme(axis.text.x = element_text(face = 'bold', size = 10),
                     axis.text.y = element_text(face = 'bold', size = 10))

#Pour fulldt, il y a 772 eleves scolarises a Gabriel Pereira et 272  a Mousinho da Silveira.

# b) sexe en fonction de l'ÃƒÂ©cole
ggplot(fulldt) +
  aes(x = sex, fill = school) +
  geom_bar() +
  scale_fill_hue(direction = 1) +
  labs(
    x = "Sexe",
    y = "Effectifs",
    title = "RÃƒÂ©partition du sexe en fonction de l'ÃƒÂ©cole"
  ) +
  theme_minimal()

#Il y a 591 filles et 453 garcons au sein des 2 ÃƒÂ©coles


# c)Age en fonction du sexe
ggplot(fulldt) +
  aes(x = age, fill = sex) +
  geom_histogram(bins = 30L) +
  scale_fill_hue(direction = 1) +
  labs(
    x = "Age",
    y = "Effectifs",
    title = "Repartition de l'age en fonction du sexe"
  ) +
  theme_minimal()

# d) Adresse
#Adresse en fonction de ÃƒÂ©cole
ggplot(fulldt) +
  aes(x = address, fill = school) +
  geom_bar() +
  scale_fill_hue(direction = 1) +
  labs(
    x = "Adresse",
    y = "Effectif",
    title = "Repartition de l'adresse (U ou R) en fonction de l'ecole"
  ) +
  theme_minimal()

#Visualisation seulement adresse
as.data.frame(table(fulldt$address))
ggplot(as.data.frame(table(fulldt$address))) +
  geom_bar(aes(x = Var1, y = Freq,  fill = Var1), 
           stat = 'identity') +
  scale_fill_manual(values=c( '#2B9E67', '#FFA44B')) +
  ggtitle("Basic Bar Plot") +
  xlab("Adresse") +
  ylab("Effectifs") +
  theme_bw() +
  theme(axis.text.x = element_text(face = 'bold', size = 10),
        axis.text.y = element_text(face = 'bold', size = 10))

#e) Emploi pere

as.data.frame(table(fulldt$Fjob))
ggplot(as.data.frame(table(fulldt$Fjob))) +
  geom_bar(aes(x = Var1, y = Freq, fill = Var1), 
           stat = 'identity') +
  scale_fill_manual(values=palette) +
  ggtitle("Basic Bar Plot") +
  xlab("Job du pere") +
  ylab("Effectifs") +
  theme_bw() +
  theme(axis.text.x = element_text(face = 'bold', size = 10),
        axis.text.y = element_text(face = 'bold', size = 10))
#InterprÃƒÂ©tation: Nous observons que la catÃƒÂ©gorie "les autres" se dÃƒÂ©marque des 3 autres catÃƒÂ©gories (ÃƒÂ  la maison, santÃƒÂ© et professeurs)


#f) Emploi de la mere
as.data.frame(table(fulldt$Mjob))
ggplot(as.data.frame(table(fulldt$Mjob))) +
  geom_bar(aes(x = Var1, y = Freq, fill = Var1), 
           stat = 'identity') +
  scale_fill_manual(values=palette) +
  ggtitle("Basic Bar Plot") +
  xlab("Job de la mere") +
  ylab("Effectifs") +
  theme_bw() +
  theme(axis.text.x = element_text(face = 'bold', size = 10),
        axis.text.y = element_text(face = 'bold', size = 10))

#Ici aussi, other se dÃƒÂ©marque des autres, suivi de services



#### III. Visualision des donnÃƒÂ©es afin d'etablir une eventuelle correlation entre la consommation d'alcool et les resultats scolaires

  #a)profil general des consommateurs d'alcool, afin d'etablir une premiere typologie general :

  #Visualisation des consommations d'alcool weekend et semaine
#Consommation semaine
table(fulldt$Dalc)

ggplot(fulldt) +
  aes(x = Dalc) +
  geom_histogram(bins = 30L, fill = "#112446") +
  theme_minimal()
#En semaine, la consommation d'alcool est plutot modérer (tres peu de consommation)

table(fulldt$Walc)

ggplot(fulldt) +
  aes(x = Walc) +
  geom_histogram(bins = 30L, fill = "#112446") +
  theme_minimal()
#Il y a beaucoup plus de consommation le weekend, étant donné qu'il n'y a pas cours, plus de personnes consomment excessifement de l'alcool. 

#Impact alcool sur G3
cor1 <- G3 ~ Walc + Dalc
lm1<-lm(cor1 , data = fulldt)
coefplot(lm1 , outerCI = 1.96 , intercept = FALSE)
#La consommation d'alcool en semaine a plus d'impact negatif sur les resultats scolaires G3 que la consommation le weekend. 
#Les deux coefficient est negative, mais l'intervalle de confiance de Walc couvre 0, donc le coefficient de Walc n'est pas significatif. 
#Cela peut etre du au fait qu'en semaine, les personnes consommant de l'alcool ne se concentre pas aux revisions donc leurs notes sont impactés. 
#Dalc= -0.39 et walc -0.17

cor2 <- age ~ Walc + Dalc
lm2<-lm(cor2 , data = fulldt)
coefplot(lm2 , outerCI = 1.96 , intercept = FALSE)
#Ici, nous chercons à comprendre si la consommations d'alcool en semaine ou en weekend depend de l'age
#Les deux coefficient sont positive, mais etant donne que l'intervalle de confiance de Walc couvre 0, le coefficent n'est pas significative contrairement a dalc. 
#La consommation d'alcool en semaine depend plus de l'age que la consommation le weekend, c'est a dire que par exemple, en fonction de l'age, les personnes font plus attention à leurs consommations d'alcool en semaine que en weekend.  

ggplot(fulldt, aes(x = Walc, y = Dalc , color = sex, size = freetime))+   geom_jitter(position=position_jitter(0.2))
#Analuse Aurore
#Les femmes ont une consommation plutot modÃƒÂ©rer que les hommes, on retrouve plus les H dans cat 5

ggplot(fulldt, aes(x = Walc, y = Dalc , color = address, size = freetime))+ geom_jitter(position=position_jitter(0.2))
#Analyse Doriane



#Consommation d'alcool selon job mere
ggplot(fulldt) +
  aes(x = Dalc, y = Walc, colour = Mjob, size = Mjob) +
  geom_jitter() +
  scale_color_viridis_d(option = "plasma", direction = 1) +
  labs(
    x = "Consommation alcool semaine",
    y = "Consommation alcool weekend",
    title = "Nuage de point consommation alcool en fonction du job de la mere"
  ) +
  theme_bw()
#Analyse Hugo

#Notes G3
ggplot(fulldt) +
  aes(x = Dalc, y = Walc, colour = school, size = G3) +
  geom_jitter() +
  scale_color_hue(direction = 1) +
  labs(
    x = "Consommation alcool semaine",
    y = "Consommation alcool weekend",
    title = "Nuage de point consommation alcool en fonction G3 et ÃƒÂ©cole"
  ) +
  theme_bw()
#Analyse Juliette

table(fulldt$G3)

#Sumeyye
ggplot(fulldt) +
  aes(x = G3, y = sex) +
  geom_boxplot(fill = "#BDD3E8") +
  labs(x = "Notes G3", y = "Sexe", title = "Boxplot") +
  theme_bw()
#Pour le sexe masculin, il y a 2 valeurs aberrantes et pour le sexe feminin seulement 1.
#Les notes médians sont plus eleves pour les filles avec environ 12 et 11 pour les garcons. 
#Par contre, le minimum est plus eleve chez les garcon, le maximum aussi est plus eleve pour les garcons. 
#Cela s'explique que les notes des filles sont similaire et que globalement les filles ont des notes eleves alors que chez les garcons, malgre quelques bonnes notes, ils ont plutot des notes moyennes. 

ggplot(fulldt) +
  aes(x = G3, y = Mjob, fill = Mjob) +
  geom_boxplot() +
  scale_fill_brewer(palette = "OrRd", direction = 1) +
  labs(x = "Notes G3", y = "Job mere", title = "Boxplot") +
  theme_bw()
#Pour les boites a moustache du metier de la mere, il y a 6 valeurs aberrantes pour la categorie "autres", ce sont des valeurs qui sont supérieures ou inférieures aux limites définies par les moustaches. 
#On remarque que les eleves de mere travaillant dans la sante ou les eleves de meres professeurs ont des meilleurs notes (médiant) que les meres aux foyers et "autres". 
#Le minimum de mere-sante est de 7 et le maximum est de 20 contrairement au mere-maison ou mere-service qui est de 5 et 18,5 respectivement. 
#Par contre, l'icart interquartile est vraiment important pour les meres-sante, ce qui signifie que les notes sont variables. 


#Aurore
ggplot(fulldt) +
  aes(x = G3, y = Fjob, fill = Fjob) +
  geom_boxplot() +
  scale_fill_brewer(palette = "OrRd", direction = 1) +
  labs(x = "Notes G3", y = "Job mere", title = "Boxplot") +
  theme_bw()



#Faire boxplot pour etudes pere et mere 

ggplot(fulldt) +
  aes(x = G3, y = guardian, fill = guardian) +
  geom_boxplot() +
  scale_fill_hue(direction = 1) +
  labs(
    x = "Notes G3",
    y = "Tuteur",
    title = "Boxplot impact tuteur eleve sur G3"
  ) +
  theme_minimal()
#Analyser Sumeyye

#b)Recherche plus poussÃ©e des raisons d'une consommation d'alcool Â«excessiveÂ» :








#Partie Juliette

library(ggplot2)

#Consommation d'alcool selon la taille de la famille

ggplot(fulldt) +
  aes(x = Dalc, y = Walc, colour = famsize, size = famsize) +
  geom_jitter() +
  scale_color_viridis_d(option = "plasma", direction = 1) +
  labs(
    x = "Consommation alcool semaine",
    y = "Consommation alcool weekend",
    title = "Nuage de point consommation alcool en fonction du job de la mere"
  ) +
  theme_bw()


## Encore essais Juliette
# Croisement de certaines variables :
# Alcool / sexe

# La consommation d'alcool la semaine selon le sexe

ggplot(fulldt) +
  aes(x = Dalc, fill = sex) +
  geom_histogram(bins = 30L) +
  scale_fill_hue(direction = 1) +
  labs(x = "Consommation d'alcool en semaine (1 ÃƒÆ’Ã‚Â©tant le plus faible)", y = "Nombre d'ÃƒÆ’Ã‚Â©lÃƒÆ’Ã‚Â¨ves",
    title = "Consommation d'alcool en semaine selon le sexe ",
    fill = "sexe"
  labs(x = "Consommation d'alcool en semaine (1 ÃƒÂ©tant le plus faible)", y = "Nombre d'ÃƒÂ©lÃƒÂ¨ves",
       title = "Consommation d'alcool en semaine selon le sexe ",
       fill = "sexe"
  ) +
  theme_minimal()

# La consommation d'alcool le week-end selon le sexe

ggplot(fulldt) +
  aes(x = Walc, fill = sex) +
  geom_histogram(bins = 30L) +
  scale_fill_hue(direction = 1) +
  labs(x = "Consommation d'alcool pendant le week-end (1 ÃƒÆ’Ã‚Â©tant le plus faible)", y = "Nombre d'ÃƒÆ’Ã‚Â©lÃƒÆ’Ã‚Â¨ves", 
       title = "Consommation d'alcool le week-end chez les ÃƒÆ’Ã‚Â©lÃƒÆ’Ã‚Â¨ves selon le sexe ", 

  labs(x = "Consommation d'alcool pendant le week-end (1 ÃƒÂ©tant le plus faible)", y = "Nombre d'ÃƒÂ©lÃƒÂ¨ves", 
       title = "Consommation d'alcool le week-end chez les ÃƒÂ©lÃƒÂ¨ves selon le sexe ", 
       fill = "sexe") +
  theme_minimal()

# Consommation d'alcool semaine et week-end confondus :

alc <- c(fulldt$Dalc, fulldt$Walc)
view(alc)

ggplot(fulldt) +
  aes(x = alc, fill = sex) +
  geom_histogram(bins = 30L) +
  scale_fill_hue(direction = 1) +
  labs(x = "DegrÃƒÆ’Ã‚Â© de consommation d'alcool (1 ÃƒÆ’Ã‚Â©tant le plus faible)", y = "Nombre d'ÃƒÆ’Ã‚Â©lÃƒÆ’Ã‚Â¨ves", 
       title = "Consommation d'alcool chez les ÃƒÆ’Ã‚Â©lÃƒÆ’Ã‚Â¨ves selon le sexe ", 
       fill = "sexe") +
  theme_minimal()

## -> ÃƒÆ’Ã‚Â§a marche pas! 
  
  labs(x = "DegrÃƒÂ© de consommation d'alcool (1 ÃƒÂ©tant le plus faible)", y = "Nombre d'ÃƒÂ©lÃƒÂ¨ves", 
       title = "Consommation d'alcool chez les ÃƒÂ©lÃƒÂ¨ves selon le sexe ", 
       fill = "sexe") +
  theme_minimal()
## -> ÃƒÂ§a marche pas!

# La consommation d'alcool la semaine selon l'environnement (rural/urbain)

ggplot(fulldt) +
 aes(x = Walc, fill = address) +
 geom_histogram(bins = 30L) +
 scale_fill_hue(direction = 1) +
<<<<<<< Updated upstream
 labs(x = "Consommation d'alcool pendant leweek-end ", y = "ElÃƒÆ’Ã‚Â¨ves dÃƒÆ’Ã‚Â©clarant boire le week-end", 
 title = "Consommation d'alcool le week-end chez les ÃƒÆ’Ã‚Â©lÃƒÆ’Ã‚Â¨ves selon l'environnement ", subtitle = "Tous niveaux confondus", 
 fill = "Cadre de vie (R = rural, U = Urbain)") +
 theme_minimal()
=======
 labs(x = "Consommation d'alcool pendant leweek-end ", y = "ElÃƒÂ¨ves dÃƒÂ©clarant boire le week-end", 
 title = "Consommation d'alcool le week-end chez les ÃƒÂ©lÃƒÂ¨ves selon l'environnement ", subtitle = "Tous niveaux confondus", 
 fill = "Cadre de vie (R = rural, U = Urbain)") + theme_minimal()
>>>>>>> Stashed changes


  aes(x = Walc, fill = address) +
  geom_histogram(bins = 30L) +
  scale_fill_hue(direction = 1) +
<<<<<<< Updated upstream
  labs(x = "Consommation d'alcool pendant leweek-end ", y = "ElÃƒÂ¨ves dÃƒÂ©clarant boire le week-end", 
       title = "Consommation d'alcool le week-end chez les ÃƒÂ©lÃƒÂ¨ves selon l'environnement ", subtitle = "Tous niveaux confondus", 
       fill = "Cadre de vie (R = rural, U = Urbain)") +
  theme_minimal()
=======
  labs(x = "Consommation d'alcool pendant leweek-end ", y = "ElÃ¨ves dÃ©clarant boire le week-end", 
       title = "Consommation d'alcool le week-end chez les Ã©lÃ¨ves selon l'environnement ", subtitle = "Tous niveaux confondus", 
       fill = "Cadre de vie (R = rural, U = Urbain)") + theme_minimal()
>>>>>>> Stashed changes
       

# Soutien scolaire et consommation d'alcool en semaine

ggplot(fulldt) +
  aes(x = Dalc, fill = schoolsup) +
  geom_histogram(bins = 30L) +
  scale_fill_hue(direction = 1) +
  labs(
    x = "QuantitÃƒÂ© d'alcool consommÃƒÂ©e en semaine (1 ÃƒÂ©tant le plus faible)",
    y = "nombre d'ÃƒÂ©lÃƒÂ¨ves",
    title = "Soutien scoalire et consommation d'alcool le week-end",
    fill = "BÃƒÂ©nÃƒÂ©ficie de soutien scolaire"
  ) +
  theme_minimal()

##=> Les ÃƒÂ©lÃƒÂ¨ves qui dÃƒÂ©clarent consommer peu d'alcool en semaine, sont plus nombreux ÃƒÂ  bÃƒÂ©nÃƒÂ©ficier de soutien scolaire
       
       
        # Essaie de calcul des variables famsup et paidclass. 
              
              # Consomation d'alcool excessive selon le soutien scolaire familial : variable famsup :
              
              gglot(fulldt) +
                aes(x = Dalc + Walk, fill = famsup) +
                geom_histogram(bins = 30L) +
                scale_fill_hue(direction = 1) +
                labs (   
                  x = "consomation d'alcool en semaine et en week end = consomation d'alcool excessive"
                  y = "Nombres d'eleves"
                  title = "Le soutien scolaire familial et la consomation excessive d'alcool",
                  fill = "Beneficie de soutien scolaire familial"
                ) +
                theme_minimal()
              
              
              # Consomation d'alcool excessive selon les cours supplÃ©mentaire payant : varable paidclass :
              
              gglot(fulldt) +
                aes(x = Dalc + Walk, fill = paidclass) +
                geom_histogram(bins = 30L) +
                scale_fill_hue(direction = 1) +
                labs (   
                  x = "consomation d'alcool en semaine et en week end = consomation d'alcool excessive"
                  y = "Nombres d'eleves"
                  title = "Le soutien scolaire familial et la consomation excessive d'alcool",
                  fill = "Beneficie de soutien scolaire familial"
                ) +
                theme_minimal()
              
              # Ne marche pas sur mon ordinateur car pas tout les paquets qui s'installent Ã  voir si marche de maniÃ¨re gÃ©nÃ©rale. 

              
              
#Test Hugo
              